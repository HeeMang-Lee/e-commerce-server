# 요구사항 정의서

## 📋 프로젝트 개요
이커머스 시스템의 핵심 기능인 상품 관리, 주문/결제, 쿠폰, 포인트 시스템을 설계하고 구현합니다.

---

## 🎯 기능적 요구사항 (Functional Requirements)

### 1. 상품 관리
| ID | 요구사항 | 우선순위 |
|----|---------|---------|
| F-P-01 | 사용자는 개별 상품을 조회할 수 있어야 한다. | High |
| F-P-02 | 사용자는 상품 목록을 조회할 수 있어야 한다. | High |
| F-P-03 | 사용자는 상품 주문 내역 기준 판매량이 높은 상품을 조회할 수 있다. (랭킹순) | Medium |
| F-P-04 | 사용자는 최근 3일 간 가장 많이 팔린 상품 5개에 대한 정보를 확인할 수 있어야 한다. | Medium |

### 2. 주문/결제
| ID | 요구사항 | 우선순위 |
|----|---------|---------|
| F-O-01 | 사용자는 여러 개의 상품을 각각의 수량을 지정해서 주문할 수 있어야 한다. | High |
| F-O-02 | 사용자는 주문내역을 토대로 결제할 수 있어야 한다. | High |
| F-O-03 | 사용자는 주문 당시 상품의 정보들을 조회할 수 있어야 한다. (가격, 이름 등의 스냅샷) | High |
| F-O-04 | 사용자는 본인의 주문 목록과 각 상품별 주문 상태를 조회할 수 있어야 한다. | High |

### 3. 쿠폰
| ID | 요구사항 | 우선순위 |
|----|---------|---------|
| F-C-01 | 사용자는 선착순으로 발급되는 쿠폰에 대한 발급 요청을 할 수 있어야 한다. | High |
| F-C-02 | 사용자는 본인의 보유 쿠폰들을 조회할 수 있어야 한다. | High |
| F-C-03 | 사용자는 결제 시 보유 쿠폰을 선택하여 사용할 수 있으며, 쿠폰의 할인 금액만큼 결제 금액이 차감되어야 한다. | High |
| F-C-04 | 한 주문에 동일한 쿠폰을 중복으로 사용할 수 없어야 한다. | High |

### 4. 포인트
| ID | 요구사항 | 우선순위 |
|----|---------|---------|
| F-PT-01 | 사용자는 본인의 포인트 잔액을 조회할 수 있어야 한다. | High |
| F-PT-02 | 사용자는 본인의 포인트 금액을 충전할 수 있어야 한다. | High |
| F-PT-03 | 사용자는 포인트 충전/사용 이력을 조회할 수 있어야 한다. | Medium |

### 5. 데이터 연동
| ID | 요구사항 | 우선순위 |
|----|---------|---------|
| F-D-01 | 결제가 성공하면 주문 정보가 데이터 분석 플랫폼으로 전송되어야 한다. | High |

---

## ⚙️ 비기능적 요구사항 (Non-Functional Requirements)

### 1. 동시성 제어 (Concurrency)
| ID | 요구사항 | 우선순위 |
|----|---------|---------|
| NF-CC-01 | 상품 주문 시 재고 차감이 정확히 처리되어야 하며, 동시 요청이 들어와도 재고 수량을 넘어서는 주문이 발생하지 않아야 한다. | Critical |
| NF-CC-02 | 선착순 쿠폰은 요청이 들어온 순서대로 발급되어야 하며, 동시 요청이 들어와도 중복 발급이 발생하지 않아야 한다. | Critical |

### 2. 데이터 정합성 (Data Consistency)
| ID | 요구사항 | 우선순위 |
|----|---------|---------|
| NF-DC-01 | 시스템은 다수 인스턴스에서 동시에 실행되더라도 동작에 일관성이 있어야 하며, 공유 자원의 정합성이 보장되어야 한다. | Critical |

### 3. 안정성 (Reliability)
| ID | 요구사항 | 우선순위 |
|----|---------|---------|
| NF-RL-01 | 데이터 플랫폼으로의 주문 정보 전송 실패에 대한 재시도 전략을 포함해야 한다. (아웃박스 패턴) | High |
| NF-RL-02 | 재고가 부족한 경우 명확한 오류 메시지를 제공해야 한다. | High |

### 4. 모니터링 & 추적성 (Observability)
| ID | 요구사항 | 우선순위 |
|----|---------|---------|
| NF-OB-01 | 모든 주요 트랜잭션(주문, 결제, 쿠폰 발급)은 로그로 기록되어야 한다. | Medium |
| NF-OB-02 | 모든 API는 표준화된 에러 코드와 메시지를 반환해야 한다. | Medium |

---

## 🎬 핵심 시나리오

### 시나리오 1: 일반 주문 및 결제
```
1. 사용자가 상품 목록을 조회한다.
2. 원하는 상품을 선택하고 수량을 지정한다.
3. 주문을 생성한다.
4. 시스템이 재고를 확인한다.
5. 재고가 충분한 경우, 결제를 진행한다.
6. 포인트를 사용하여 결제한다.
7. 결제 성공 시 재고를 차감한다.
8. 주문 정보를 외부 데이터 플랫폼으로 전송한다.
9. 결제 완료 응답을 반환한다.
```

### 시나리오 2: 쿠폰 사용 주문
```
1. 사용자가 선착순 쿠폰 발급을 요청한다.
2. 시스템이 쿠폰 발급 가능 수량을 확인한다.
3. 발급 가능한 경우 사용자에게 쿠폰을 발급한다.
4. 사용자가 상품을 주문한다.
5. 결제 시 보유한 쿠폰을 선택한다.
6. 할인이 적용된 금액으로 결제한다.
7. 쿠폰 상태를 '사용됨'으로 변경한다.
```

### 시나리오 3: 재고 부족 처리
```
1. 사용자가 상품을 주문한다.
2. 시스템이 재고를 확인한다.
3. 재고가 부족한 경우 오류 메시지를 반환한다.
4. 주문이 생성되지 않는다.
```

### 시나리오 4: 동시 주문 처리
```
1. 여러 사용자가 동시에 동일 상품을 주문한다.
2. 시스템이 동시성 제어를 통해 재고를 순차적으로 차감한다.
3. 재고 범위 내의 주문만 성공한다.
4. 재고 초과 주문은 실패 처리된다.
```

---

## 📊 유스케이스 목록

| 액터 | 유스케이스 | 설명 |
|------|----------|------|
| 사용자 | 상품 조회 | 개별 상품 또는 상품 목록을 조회한다 |
| 사용자 | 인기 상품 조회 | 판매량 기준 상위 상품을 조회한다 |
| 사용자 | 주문 생성 | 여러 상품을 장바구니에 담아 주문한다 |
| 사용자 | 결제 처리 | 주문에 대한 결제를 진행한다 |
| 사용자 | 주문 내역 조회 | 본인의 주문 내역과 상품별 상태를 조회한다 |
| 사용자 | 쿠폰 발급 요청 | 선착순 쿠폰을 발급받는다 |
| 사용자 | 보유 쿠폰 조회 | 본인이 보유한 쿠폰 목록을 조회한다 |
| 사용자 | 쿠폰 사용 | 결제 시 보유 쿠폰을 사용한다 |
| 사용자 | 포인트 조회 | 본인의 포인트 잔액을 조회한다 |
| 사용자 | 포인트 충전 | 포인트를 충전한다 |
| 사용자 | 포인트 이력 조회 | 포인트 충전/사용 내역을 조회한다 |
| 시스템 | 재고 관리 | 주문 시 재고를 차감하고 동시성을 제어한다 |
| 시스템 | 데이터 전송 | 결제 완료된 주문 정보를 외부로 전송한다 |

---

## 🔐 제약사항

### 비즈니스 규칙
1. 한 주문에는 하나의 쿠폰만 사용 가능
2. 쿠폰은 유효기간 내에만 사용 가능
3. 포인트는 0 미만이 될 수 없음
4. 재고는 0 미만이 될 수 없음
5. 주문 당시 상품 정보는 스냅샷으로 보관

### 기술적 제약
1. 동시성 제어는 데이터베이스 레벨에서 처리
2. 외부 데이터 전송 실패는 주문 성공에 영향을 주지 않음
3. 모든 금액은 원 단위로 처리 (소수점 없음)

